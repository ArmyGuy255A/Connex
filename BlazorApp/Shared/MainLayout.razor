@using Tablazor
@using Infrastructure.Identity
@using Microsoft.AspNetCore.Identity
@inherits LayoutComponentBase
@inject TablazorJsInterop JsInterop
@inject UserManager<IdentityUser> UserManager
@* @inject ApplicationUserManager UserManager *@
@inject AuthenticationStateProvider AuthenticationStateProvider

<PageTitle>BlazorApp</PageTitle>

<TablerPage>
    <TablerNavbarHeader ShowNotifications="false">
        <AuthorizeView>
            <Authorized>
                <TablerButton BootType="outline" href="/admin">Admin</TablerButton>
                <TablerButton BootType="outline" href="/swagger">Swagger</TablerButton>
            </Authorized>
            <NotAuthorized>
                <TablerButton BootType="ghost" href="Identity/Account/Login">Login</TablerButton>
            </NotAuthorized>
        </AuthorizeView>
    </TablerNavbarHeader>
    <AuthorizeView>
        <Authorized>
            <TablerNavbar />
        </Authorized>
    </AuthorizeView>
    <TablerPageWrapper Title="MainLayout" Pretitle="Current Location:">
        @Body
    </TablerPageWrapper>
</TablerPage>

@code
{
    protected override async Task OnInitializedAsync()
    {
        
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;
        Console.WriteLine("Hello world");
        
        await base.OnInitializedAsync();
    }
  
    private bool firstRender = true;
    
    // private string title = "MainLayout";
  
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (this.firstRender)
        {
    // await JavaScript.InvokeVoidAsync("initializeTooltips");
    // await JsInterop.Prompt("Hello World");
            await JsInterop.Print();
            await JsInterop.InitializeTooltips();
            await JsInterop.InitializeDropdowns();

      
            this.firstRender = false;
      
            //TODO: This is not refreshing the current page title
            // title = await JsInterop.GetPageTitle();

        }

    }

}